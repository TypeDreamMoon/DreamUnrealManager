<Page
    x:Class="DreamUnrealManager.Views.LauncherPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:DreamUnrealManager.Models"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:helpers="using:DreamUnrealManager.Helpers"
    mc:Ignorable="d">

    <!-- ========== 全局资源 ========== -->
    <Page.Resources>
        <!-- bool -> Visibility -->
        <helpers:BooleanToVisibilityConverter x:Key="BoolToVisibility" />

        <!-- ===== ItemsPanel（3种布局） ===== -->
        <!-- 网格 -->
        <ItemsPanelTemplate x:Key="GridItemsPanel">
            <ItemsWrapGrid Orientation="Horizontal"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center" />
        </ItemsPanelTemplate>

        <!-- 列表 -->
        <ItemsPanelTemplate x:Key="ListItemsPanel">
            <StackPanel Orientation="Vertical"
                        Spacing="8"
                        Margin="0,4,0,4" />
        </ItemsPanelTemplate>

        <!-- 紧凑 -->
        <ItemsPanelTemplate x:Key="CompactItemsPanel">
            <ItemsWrapGrid Orientation="Horizontal"
                           HorizontalAlignment="Stretch"
                           VerticalAlignment="Top" />
        </ItemsPanelTemplate>

        <!-- ===== DataTemplates（3种卡片） ===== -->

        <MenuFlyout x:Key="ProjectMenuFlyoutTemplate">

            <MenuFlyoutItem Text="启动" Tag="{Binding}" Click="ContextMenu_LaunchProject_Click" />
            <MenuFlyoutItem Text="用 IDE 打开" Tag="{Binding}" Click="ContextMenu_OpenWithIDE_Click" />
            <MenuFlyoutItem Text="打开项目文件夹" Tag="{Binding}" Click="ContextMenu_OpenFolder_Click" />
            <MenuFlyoutItem Text="查看详情"
                            Tag="{Binding}"
                            Click="ContextMenu_ShowDetails_Click" />
            <MenuFlyoutItem Text="收藏/取消收藏"
                            Tag="{Binding}"
                            Click="ContextMenu_ToggleFavorite_Click" />
            <MenuFlyoutSeparator />
            <MenuFlyoutItem Visibility="{Binding IsCPlusPlusProject, Mode=OneWay, Converter={StaticResource BoolToVisibility}}"
                            Text="生成 VS 项目文件"
                            Tag="{Binding}"
                            Click="ContextMenu_GenerateVSProject_Click" />
            <MenuFlyoutItem Text="刷新项目" Tag="{Binding}" Click="ContextMenu_RefreshProject_Click" />
            <MenuFlyoutItem Text="切换引擎版本" Tag="{Binding}" Click="ContextMenu_SwitchEngine_Click" />
            <MenuFlyoutSeparator />
            <MenuFlyoutItem Text="从列表中移除" Tag="{Binding}" Click="ContextMenu_RemoveProject_Click" />
        </MenuFlyout>

        <!-- 网格卡片（图主导） -->
        <DataTemplate x:Key="GridProjectTemplate" x:DataType="models:ProjectInfo">
            <Border Width="360"
                    Height="360"
                    Margin="8"
                    CornerRadius="12"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    PointerEntered="ProjectCard_PointerEntered"
                    PointerExited="ProjectCard_PointerExited">

                <Grid>
                    <!-- 缩略图 -->
                    <Border CornerRadius="12">
                        <Image Source="{x:Bind ProjectIconPath}"
                               Stretch="UniformToFill"
                               ImageFailed="ProjectImage_ImageFailed" />
                    </Border>

                    <!-- 底部信息条 -->
                    <StackPanel Orientation="Vertical"
                                Spacing="2"
                                Padding="10"
                                VerticalAlignment="Bottom">
                        <StackPanel.Background>
                            <SolidColorBrush Color="Black" Opacity="0.45" />
                        </StackPanel.Background>
                        <TextBlock Text="{x:Bind DisplayName}"
                                   Style="{ThemeResource BodyStrongTextBlockStyle}"
                                   Foreground="White"
                                   TextTrimming="CharacterEllipsis" />
                        <TextBlock Text="{x:Bind EngineDisplayName, Mode=OneWay}"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Foreground="#CCFFFFFF"
                                   TextTrimming="CharacterEllipsis" />
                    </StackPanel>

                    <!-- 悬浮操作层 -->
                    <Grid x:Name="HoverOverlay"
                          Background="#5F000000"
                          CornerRadius="12"
                          Visibility="Collapsed"
                          IsHitTestVisible="True">
                        <StackPanel Orientation="Horizontal"
                                    Spacing="8"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
                            <Button Content="启动"
                                    Tag="{x:Bind}"
                                    Click="StartProjectButton_OnClick" />
                            <Button Content="更多"
                                    Tag="{x:Bind}">
                                <Button.Flyout>
                                    <StaticResource ResourceKey="ProjectMenuFlyoutTemplate" />
                                </Button.Flyout>
                            </Button>
                        </StackPanel>
                    </Grid>

                    <!-- 元数据加载遮罩 -->
                    <Grid Background="#3F000000"
                          CornerRadius="12"
                          Visibility="{x:Bind IsLoadingMeta, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
                        <ProgressRing IsActive="True"
                                      Width="28" Height="28"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center" />
                    </Grid>

                    <Button Tag="{x:Bind}"
                            Click="ToggleFavorite_Click"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Margin="6"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="12"
                            Padding="6">
                        <FontIcon Glyph="{x:Bind FavoriteGlyph, Mode=OneWay}"
                                  FontSize="14" />
                    </Button>
                </Grid>

                <!-- 右键菜单（挂在 Border 上） -->
                <Border.ContextFlyout>
                    <StaticResource ResourceKey="ProjectMenuFlyoutTemplate" />
                </Border.ContextFlyout>
            </Border>
        </DataTemplate>


        <!-- 列表卡片（信息丰富） -->
        <DataTemplate x:Key="ListProjectTemplate" x:DataType="models:ProjectInfo">
            <Border Margin="0,8"
                    CornerRadius="10"
                    MinHeight="140"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1">

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- 左：缩略图 -->
                    <Border Grid.Column="0"
                            Width="120" Height="120"
                            Margin="12"
                            CornerRadius="8, 0, 8, 0"
                            Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}">
                        <Image Source="{x:Bind ProjectIconPath}"
                               Stretch="UniformToFill"
                               ImageFailed="ProjectImage_ImageFailed" />
                    </Border>

                    <!-- 中：文本信息 -->
                    <StackPanel Grid.Column="1"
                                Spacing="6"
                                Margin="8,12,12,12"
                                VerticalAlignment="Center">

                        <!-- 标题行：名称 + Git 标签 -->
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="{x:Bind DisplayName}"
                                       Style="{ThemeResource BodyStrongTextBlockStyle}"
                                       FontSize="18"
                                       TextTrimming="CharacterEllipsis" />
                            <Border Background="{ThemeResource AccentFillColorSecondaryBrush}"
                                    Padding="6,2"
                                    CornerRadius="6"
                                    VerticalAlignment="Center"
                                    Visibility="{x:Bind IsGitEnabled, Converter={StaticResource BoolToVisibility}}">
                                <TextBlock Text="Git"
                                           Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                                           Style="{ThemeResource CaptionTextBlockStyle}" />
                            </Border>
                        </StackPanel>

                        <!-- 描述 -->
                        <TextBlock Text="{x:Bind DescriptionDisplay}"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   TextTrimming="CharacterEllipsis" />

                        <!-- 元信息行 -->
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <FontIcon Glyph="&#xE7F8;" />
                                <TextBlock Text="{x:Bind EngineDisplayName}"
                                           Style="{ThemeResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <FontIcon Glyph="&#xE823;" />
                                <TextBlock Text="{x:Bind LastModifiedString}"
                                           Style="{ThemeResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <FontIcon Glyph="&#xE81E;" />
                                <TextBlock Text="{x:Bind ProjectSizeString}"
                                           Style="{ThemeResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <FontIcon Glyph="&#xE8FA;" />
                                <TextBlock Text="{x:Bind ModulesCount}"
                                           Style="{ThemeResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                <TextBlock Text=" 模块"
                                           Style="{ThemeResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <FontIcon Glyph="&#xE90F;" />
                                <TextBlock Text="{x:Bind EnabledPluginsCount}"
                                           Style="{ThemeResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                <TextBlock Text=" 插件"
                                           Style="{ThemeResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                            </StackPanel>
                        </StackPanel>

                        <!-- Git 信息 -->
                        <TextBlock Text="{x:Bind GitInfoString}"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                    </StackPanel>

                    <!-- 右：操作 -->
                    <StackPanel Grid.Column="2"
                                Orientation="Horizontal"
                                Spacing="8"
                                VerticalAlignment="Center"
                                Margin="8,12,12,12">
                        <Button Tag="{x:Bind}"
                                Click="ToggleFavorite_Click"
                                Padding="4"
                                Background="Transparent"
                                BorderThickness="0"
                                ToolTipService.ToolTip="{x:Bind IsFavorite, Mode=OneWay}">
                            <FontIcon Glyph="{x:Bind FavoriteGlyph, Mode=OneWay}" />
                        </Button>
                        <Button MinWidth="110"
                                Tag="{x:Bind}"
                                Click="StartProjectButton_OnClick">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE768;" />
                                <TextBlock Text="启动项目" />
                            </StackPanel>
                        </Button>

                        <Button MinWidth="110"
                                Tag="{x:Bind}"
                                Click="StartWithIdeButton_OnClick"
                                Visibility="{x:Bind IsCPlusPlusProject, Mode=OneWay, Converter={StaticResource BoolToVisibility}}">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xEC7A;" />
                                <TextBlock Text="{x:Bind GetIdeButtonText()}" />
                            </StackPanel>
                        </Button>

                        <Button MinWidth="110" Tag="{x:Bind}" ToolTipService.ToolTip="更多操作">
                            <Button.Flyout>
                                <StaticResource ResourceKey="ProjectMenuFlyoutTemplate" />
                            </Button.Flyout>
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE712;" />
                                <TextBlock Text="其他操作" />
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!-- 加载遮罩（元数据阶段） -->
                    <Grid Grid.ColumnSpan="3"
                          Background="#3F000000"
                          Visibility="{x:Bind IsLoadingMeta, Mode=OneWay, Converter={StaticResource BoolToVisibility}}"
                          CornerRadius="10">
                        <ProgressRing IsActive="True"
                                      Width="28" Height="28"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center" />
                    </Grid>
                </Grid>
                <!-- 右键菜单（挂在根） -->
                <Border.ContextFlyout>
                    <StaticResource ResourceKey="ProjectMenuFlyoutTemplate" />
                </Border.ContextFlyout>
            </Border>
        </DataTemplate>

        <!-- 紧凑卡片（高密度） -->
        <DataTemplate x:Key="CompactProjectTemplate" x:DataType="models:ProjectInfo">
            <Border>
                <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                      CornerRadius="8"
                      Height="80"
                      MinWidth="400"
                      MaxWidth="800"
                      Padding="0, 0, 15, 0"
                      ColumnSpacing="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- 缩略图 -->
                    <Border Grid.Column="0" Width="80"
                            Height="80"
                            CornerRadius="8, 0, 0, 8"
                            Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}">
                        <Image Grid.Column="0"
                               Width="80"
                               Height="80"
                               Stretch="UniformToFill"
                               Source="{Binding ThumbnailUri}"
                               ImageFailed="ProjectImage_ImageFailed"
                               AutomationProperties.Name="{Binding DisplayName}" />
                    </Border>

                    <!-- 文本区 -->
                    <!--
                    1. Project Name
                    2. Engine Tab
                    3. Information
                    -->
                    <StackPanel Grid.Column="1" Spacing="4">
                        <!-- 标题行：收藏星 + 名称 + 引擎标签 -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <!-- 收藏星（填充/空心由后端 Glyph 提供） -->
                                <Button Tag="{x:Bind}"
                                        Click="ToggleFavorite_Click"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Top"
                                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        CornerRadius="12">
                                    <FontIcon Glyph="{x:Bind FavoriteGlyph, Mode=OneWay}"
                                              FontSize="10" />
                                </Button>

                                <TextBlock Text="{Binding DisplayName}"
                                           FontSize="16"
                                           FontWeight="SemiBold"
                                           TextTrimming="CharacterEllipsis"
                                           ToolTipService.ToolTip="{Binding DisplayName}" />
                            </StackPanel>
                        </Grid>

                        <!-- 引擎版本标签 -->
                        <Border Padding="6,2"
                                Background="{ThemeResource SystemControlHighlightListLowBrush}"
                                CornerRadius="4"
                                VerticalAlignment="Center">
                            <TextBlock Text="{Binding EngineDisplayName}"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}" />
                        </Border>

                        <!-- 元信息（更轻的次要行） -->
                        <StackPanel Orientation="Horizontal" Spacing="14">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="上次打开时间 : "
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                                <TextBlock Text="{x:Bind GetLastUsedString()}"
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="磁盘大小 : "
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                                <TextBlock Text="{x:Bind ProjectSizeString}"
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" />
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>

                    <!-- 操作区 -->
                    <StackPanel Grid.Column="2"
                                Orientation="Horizontal"
                                Spacing="8"
                                VerticalAlignment="Center">
                        <Button x:Name="StartProjectButton"
                                Content="启动"
                                Tag="{Binding}"
                                Click="StartProjectButton_OnClick" />

                        <Button x:Name="StartWithIdeButton"
                                Content="用 IDE 打开"
                                Tag="{Binding}"
                                Click="StartWithIdeButton_OnClick" />

                        <Button x:Name="MoreCommandsButton"
                                Tag="{Binding}"
                                Click="MoreCommandsButton_OnClick" Flyout="{StaticResource ProjectMenuFlyoutTemplate}">
                            <FontIcon Glyph="&#xE712;" />
                        </Button>
                    </StackPanel>

                </Grid>
                <Border.ContextFlyout>
                    <StaticResource ResourceKey="ProjectMenuFlyoutTemplate" />
                </Border.ContextFlyout>
            </Border>
        </DataTemplate>


        <!-- ListViewItem 容器样式 -->
        <Style x:Key="ProjectItemContainerStyle" TargetType="ListViewItem">
            <Setter Property="Margin" Value="4" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="VerticalContentAlignment" Value="Stretch" />
            <Setter Property="Background" Value="Transparent" />
        </Style>

    </Page.Resources>

    <!-- ========== 页面布局 ========== -->
    <Grid x:Name="ContentArea">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />   <!-- 标题 -->
            <RowDefinition Height="Auto" />   <!-- 工具栏 -->
            <RowDefinition Height="Auto" />   <!-- 筛选栏 -->
            <RowDefinition Height="*" />      <!-- 列表 -->
            <RowDefinition Height="Auto" />   <!-- 状态栏 -->
        </Grid.RowDefinitions>

        <!-- 标题 -->
        <StackPanel Grid.Row="0" Margin="20,20,20,10">
            <TextBlock Text="项目启动器" FontSize="28" FontWeight="SemiBold" />
            <TextBlock Text="选择并启动你的 Unreal Engine 项目"
                       FontSize="14"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Margin="0,5,0,0" />
        </StackPanel>

        <!-- 工具栏 -->
        <Border Grid.Row="1"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="0,1,0,1"
                Padding="20,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- 搜索 -->
                <AutoSuggestBox x:Name="ProjectSearchBox"
                                PlaceholderText="搜索项目..."
                                Width="320"
                                HorizontalAlignment="Left"
                                QueryIcon="Find"
                                TextChanged="ProjectSearchBox_TextChanged" />

                <!-- 右侧按钮 + 布局切换 -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10">
                    <controls:Segmented x:Name="LayoutSegmented"
                                        SelectedIndex="0"
                                        SelectionChanged="LayoutSegmented_SelectionChanged">
                        <controls:SegmentedItem>
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE80A;" />
                                <TextBlock Text="网格" />
                            </StackPanel>
                        </controls:SegmentedItem>
                        <controls:SegmentedItem>
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE8FD;" />
                                <TextBlock Text="列表" />
                            </StackPanel>
                        </controls:SegmentedItem>
                        <controls:SegmentedItem>
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE8FD;" />
                                <TextBlock Text="紧凑" />
                            </StackPanel>
                        </controls:SegmentedItem>
                    </controls:Segmented>

                    <Button Content="添加项目" Click="AddProject_Click" />
                    <Button Content="自动搜索" Click="AutoSearchProjects_Click" />
                    <Button Content="刷新列表" Click="RefreshProjects_Click" />
                    <Button Content="打开项目文件夹" Click="OpenProjectFolder_Click" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- 筛选栏 -->
        <Border Grid.Row="2"
                Background="{ThemeResource LayerFillColorDefaultBrush}"
                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                BorderThickness="0,0,0,1"
                Padding="20,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                    <FontIcon Glyph="&#xE71C;" FontSize="16" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    <TextBlock Text="筛选:" FontWeight="SemiBold" VerticalAlignment="Center" />
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="15" Margin="15,0,0,0">
                    <ComboBox x:Name="EngineFilterComboBox"
                              PlaceholderText="选择引擎版本"
                              MinWidth="180"
                              SelectionChanged="EngineFilterComboBox_SelectionChanged">
                        <ComboBox.Header>
                            <TextBlock Text="引擎版本" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        </ComboBox.Header>
                    </ComboBox>

                    <ComboBox x:Name="SortOrderComboBox"
                              MinWidth="140"
                              SelectionChanged="SortOrderComboBox_SelectionChanged">
                        <ComboBox.Header>
                            <TextBlock Text="排序方式" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        </ComboBox.Header>
                        <ComboBoxItem Content="最近使用" Tag="LastUsed" IsSelected="True" />
                        <ComboBoxItem Content="名称" Tag="Name" />
                        <ComboBoxItem Content="引擎版本" Tag="Engine" />
                        <ComboBoxItem Content="项目大小" Tag="Size" />
                        <ComboBoxItem Content="修改时间" Tag="Modified" />
                    </ComboBox>
                </StackPanel>

                <ToggleButton Grid.Column="2" x:Name="FavoriteOnlyToggle"
                              Content="只看收藏"
                              Checked="FavoriteOnlyToggle_Checked"
                              Unchecked="FavoriteOnlyToggle_Checked"
                              VerticalAlignment="Center"
                              Margin="10,0,0,0" />

                <ToggleButton Grid.Column="3" x:Name="FavoriteFrontToggle"
                              Content="收藏在前"
                              Checked="FavoriteFrontToggle_Checked"
                              Unchecked="FavoriteFrontToggle_Checked"
                              VerticalAlignment="Center"
                              Margin="10,0,0,0">
                </ToggleButton>

                <StackPanel Grid.Column="4" Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                    <TextBlock x:Name="FilterStatsText"
                               Text="显示 0 个项目"
                               FontSize="12"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               VerticalAlignment="Center"
                               Margin="10,0,0,0"
                               Width="100"
                               TextAlignment="Center" />
                </StackPanel>

                <Button Grid.Column="5"
                        Content="清除筛选"
                        Click="ClearFilters_Click"
                        Margin="10,0,0,0" />
            </Grid>
        </Border>

        <!-- 内容区 -->

        <Grid Grid.Row="3" Margin="15,0,15,10" CornerRadius="0 ,0, 8, 8">
            
            <!-- 空状态 -->
            <StackPanel x:Name="EmptyStatePanel"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Spacing="20"
                        Visibility="Collapsed">
                <FontIcon Glyph="&#xE7C3;" FontSize="80"
                          Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                          HorizontalAlignment="Center" />
                <StackPanel Spacing="8" HorizontalAlignment="Center">
                    <TextBlock x:Name="EmptyStateTitle"
                               Text="暂无项目"
                               FontSize="24"
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    <TextBlock x:Name="EmptyStateMessage"
                               Text="点击下方按钮来添加你的第一个 Unreal Engine 项目"
                               FontSize="14"
                               HorizontalAlignment="Center"
                               Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                               TextAlignment="Center"
                               MaxWidth="400"
                               TextWrapping="Wrap" />
                </StackPanel>
                <Button HorizontalAlignment="Stretch" MinWidth="120" FontSize="16" Padding="20,12" Click="AddProject_Click">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE710;" FontSize="16" />
                        <TextBlock Text="添加项目" />
                    </StackPanel>
                </Button>
            </StackPanel>

            <!-- 列表 -->
            <ListView x:Name="ProjectsListView"
                      ItemsSource="{x:Bind FilteredProjects, Mode=OneWay}"
                      ItemContainerStyle="{StaticResource ProjectItemContainerStyle}"
                      IsItemClickEnabled="False"
                      SelectionMode="None"
                      HorizontalContentAlignment="Center"
                      VerticalContentAlignment="Center"
                      ItemsPanel="{StaticResource GridItemsPanel}"
                      ItemTemplate="{StaticResource GridProjectTemplate}" />
            
            <Grid x:Name="GlobalOverlay"
                  Background="#80000000"
                  Visibility="Collapsed">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
                    <ProgressRing IsActive="True" Width="40" Height="40" />
                    <TextBlock x:Name="GlobalOverlayText"
                               Text="正在加载项目信息..."
                               Foreground="White"
                               FontSize="16"
                               TextAlignment="Center" />
                </StackPanel>
            </Grid>
        </Grid>


        <!-- 底部状态条 -->
        <Border Grid.Row="4"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                Padding="20,8"
                VerticalAlignment="Bottom">
            <TextBlock x:Name="StatusText"
                       Text="就绪"
                       FontSize="12"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
        </Border>

    </Grid>
</Page>