<Page
    x:Class="DreamUnrealManager.Views.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:views="using:DreamUnrealManager.Views"
    mc:Ignorable="d">

    <Grid x:Name="ContentArea">
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel Margin="20" Spacing="20">

                <!-- 页面标题 -->
                <TextBlock Text="设置"
                           FontSize="28"
                           FontWeight="SemiBold"
                           Margin="0,0,0,10" />

                <!-- 引擎管理卡片 -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        CornerRadius="8"
                        Padding="20">
                    <StackPanel Spacing="15">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Unreal Engine 管理"
                                       FontSize="20"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center" />
                            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10">
                                <Button Content="添加引擎"
                                        Click="AddEngine_Click"
                                        Style="{ThemeResource AccentButtonStyle}" />
                                <Button Content="自动检测"
                                        Click="AutoDetect_Click" />
                                <Button Content="刷新"
                                        Click="RefreshEngines_Click" />
                            </StackPanel>
                        </Grid>

                        <!-- 引擎列表 -->
                        <ScrollViewer Height="400"
                                      VerticalScrollBarVisibility="Auto"
                                      Background="{ThemeResource ControlFillColorTransparentBrush}"
                                      BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                      BorderThickness="1"
                                      CornerRadius="4">
                            <StackPanel x:Name="EnginesStackPanel" Spacing="2" Margin="5" />
                        </ScrollViewer>

                        <TextBlock Text="提示: 可以手动添加自定义的 Unreal Engine 安装路径，或使用自动检测功能扫描常见的安装位置。"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   FontSize="12"
                                   TextWrapping="Wrap" />
                    </StackPanel>
                </Border>

                <!-- 其他设置卡片 -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        CornerRadius="8"
                        Padding="20">
                    <StackPanel Spacing="15">
                        <TextBlock Text="应用设置"
                                   FontSize="20"
                                   FontWeight="SemiBold" />

                        <ToggleSwitch x:Name="AutoScanToggle"
                                      Header="启动时自动扫描引擎"
                                      IsOn="True" />

                        <ToggleSwitch x:Name="LogDetailToggle"
                                      Header="详细构建日志"
                                      IsOn="False" />

                        <NumberBox x:Name="MaxLogLinesNumber"
                                   Header="最大日志行数"
                                   Value="1000"
                                   Minimum="100"
                                   Maximum="10000"
                                   SpinButtonPlacementMode="Inline" />
                    </StackPanel>
                </Border>

                <controls:SettingsCard x:Name="ConsoleFontSettingCard"
                                       Description="控制台字体"
                                       Header="控制台字体"
                                       CornerRadius="8">

                    <ComboBox x:Name="FontCombo"
                              PlaceholderText="选择字体…"
                              ItemsSource="{x:Bind AvailableFonts}"
                              SelectionChanged="FontCombo_SelectionChanged"
                              SelectedValuePath="Name"
                              MaxDropDownHeight="420">

                        <ComboBox.ItemTemplate>
                            <DataTemplate x:DataType="views:FontOption">
                                <Grid ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="180" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0"
                                               Text="{x:Bind Name}"
                                               VerticalAlignment="Center" />

                                    <TextBlock Grid.Column="1"
                                               Text="Aa 0123 中國汉字 かなカナ — The quick brown fox"
                                               FontFamily="{x:Bind FontFamily}"
                                               Opacity="0.9"
                                               TextTrimming="CharacterEllipsis" />
                                </Grid>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                </controls:SettingsCard>

                <controls:SettingsCard x:Name="DefaultIdeSettingCard"
                                       Description="默认启动IDE"
                                       Header="默认启动IDE"
                                       CornerRadius="8">
                    <ComboBox x:Name="DefaultIdeComboBox"
                              Header="默认启动IDE"
                              PlaceholderText="请选择默认IDE"
                              MinWidth="400"
                              SelectionChanged="DefaultIdeComboBox_OnSelectionChanged">
                        <ComboBoxItem Content="Visual Studio" Tag="VS"></ComboBoxItem>
                        <ComboBoxItem Content="Rider" Tag="RD"></ComboBoxItem>
                        <ComboBoxItem Content="Visual Studio Code" Tag="VSCode"></ComboBoxItem>
                    </ComboBox>
                </controls:SettingsCard>

                <controls:SettingsCard x:Name="IdePathSettingCard"
                                       Description="IDE路径设置"
                                       Header="IDE路径"
                                       CornerRadius="8">
                    <StackPanel Orientation="Vertical" Spacing="10">
                        <TextBlock x:Name="IdePathHeader"
                                   Text="Visual Studio 路径:"
                                   Style="{ThemeResource BaseTextBlockStyle}" />

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBox x:Name="IdePathTextBox"
                                     Grid.Column="0"
                                     PlaceholderText="例如: C:\Program Files\Microsoft Visual Studio\2022\Community\Common7\IDE\devenv.exe"
                                     TextChanged="IdePathTextBox_TextChanged" />

                            <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="10,0,0,0">
                                <Button Content="浏览..."
                                        Click="BrowseIdePath_Click" />
                                <Button Content="自动检测"
                                        Margin="10,0,0,0"
                                        Click="AutoDetectIdeButton_Click" />
                            </StackPanel>
                        </Grid>

                        <TextBlock x:Name="IdePathDescription"
                                   Text="根据选择的默认IDE，路径指向对应的可执行文件"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                   FontSize="12"
                                   TextWrapping="Wrap" />
                    </StackPanel>
                </controls:SettingsCard>

                <controls:SettingsCard x:Name="OpenConfigFolderSettingCard"
                                       Description="打开配置文件所在目录"
                                       Header="配置文件目录"
                                       IsClickEnabled="True"
                                       CornerRadius="8"
                                       Click="OpenConfigFolderButton_Click">
                    <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                        查看
                    </TextBlock>
                </controls:SettingsCard>

                <controls:SettingsCard Description="主题设置" Header="主题">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE790;" />
                    </controls:SettingsCard.HeaderIcon>
                    <ComboBox
                        x:Name="ThemeModeComboBox"
                        AutomationProperties.AutomationId="ThemeModeComboBox"
                        SelectionChanged="ThemeMode_SelectionChanged">
                        <ComboBoxItem Content="亮色" Tag="Light" />
                        <ComboBoxItem Content="暗色" Tag="Dark" />
                        <ComboBoxItem Content="系统设置" Tag="Default" />
                    </ComboBox>
                </controls:SettingsCard>

                <controls:SettingsCard Description="亚克力透明度" Header="亚克力透明度">
                    <Slider x:Name="AcrylicTintOpacitySettingSlider"
                            TickFrequency="10"
                            TickPlacement="Inline"
                            SnapsTo="StepValues"
                            ValueChanged="AcrylicTintOpacitySettingSlider_OnValueChanged" />
                </controls:SettingsCard>

                <controls:SettingsCard Description="亚克力亮度不透明度" Header="亚克力亮度不透明度">
                    <Slider x:Name="AcrylicTintLuminosityOpacitySettingSlider"
                            TickFrequency="10"
                            TickPlacement="Inline"
                            SnapsTo="StepValues"
                            ValueChanged="AcrylicTintLuminosityOpacitySettingSlider_OnValueChanged" />
                </controls:SettingsCard>

                <controls:SettingsCard Description="关掉背景图片" Header="二刺猿蒸鹅心" ContentAlignment="Right">
                    <CheckBox x:Name="CloseBackgroundImageButton"
                              Checked="CloseBackgroundImageButton_OnChanged"
                              Unchecked="CloseBackgroundImageButton_OnChanged" />
                </controls:SettingsCard>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>